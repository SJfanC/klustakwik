{"name":"Klustakwik","tagline":"","body":"KlustaKwik\r\n==========\r\n\r\nDocumentation for Masked KlustaKwik\r\n--------------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\n0) Introduction\r\n------------------------\r\n------------------------\r\n\r\nThe new masked version of KlustaKwik, currently KlustaKwik3.0.2, differs from previous versions in its use of an\r\nfmaskfile (floats between 0 and 1, .fmask file) in addition to the usual features file (.fet file). \r\n\r\nIt is designed to be used in conjunction with SpikeDetekt for clustering spike waveforms recorded on large dense probes. \r\n\r\n*Unmasked* channels are channels on which spiking activity has been found to occur by the program SpikeDetekt,\r\nwhereas *masked* channels contain only noise. The .fmask file is a text file, every line of which is a vector\r\ngiving the positions of the unmasked channels. In the .fmask file, **1** denotes *unmasked* and **0** denotes\r\n*masked*, values between 0 and 1 are also permitted at the boundaries of detected spikes.\r\n\r\n1) Parameters\r\n-------------------\r\n-------------------\r\n\r\nThe current release of masked KlustaKwik has an enormous range of parameters which can be adjusted\r\naccording to the user's needs. Many unnecessary parameters will soon be phased out, but in the interim\r\nto help beta-testers, we will describe a few of the relevant ones.\r\n\r\n    Usage: MaskedKlustaKwik FileBase ElecNo [Arguments]\r\n\r\n    Arguments (with default values): \r\n\r\n    FileBase    electrode\r\n    ElecNo\t1\r\n    MinClusters\t20\r\n    MaxClusters\t30\r\n    MaxPossibleClusters\t100\r\n    nStarts\t1\r\n    RandomSeed\t1\r\n    Debug\t0\r\n    Verbose\t1\r\n    UseFeatures\t11111111111100001\r\n    DistDump\t0\r\n    DistThresh\t6.907755\r\n    FullStepEvery\t20\r\n    ChangedThresh\t0.050000\r\n    Log\t1\r\n    Screen\t1\r\n    MaxIter\t500\r\n    StartCluFile\t\r\n    SplitEvery\t40\r\n    PenaltyK\t0.000000\r\n    PenaltyKLogN\t1.000000\r\n    Subset\t1\r\n    PriorPoint\t1\r\n    SaveSorted\t0\r\n    SaveCovarianceMeans\t0\r\n    UseMaskedInitialConditions\t0\r\n    AssignToFirstClosestMask\t0\r\n    UseDistributional\t0\r\n    help\t0\r\n\r\nThe above defaults cause KlustaKwik (classical EM algorithm) to run exactly as previous versions, but 10 times faster.\r\nThe only difference is that the parameter PenaltyMix has been replaced with two parameters, PenaltyK and PenaltyKLogN.\r\n\r\n+ **Penalties**\r\n\r\n \r\n\r\nPenaltyMix 1 corresponds to (PenaltyK 0, PenaltyKLogN 1) (Bayesian Information Criterion)\r\n\r\nPenaltyMix 0 corresponds to (PenaltyK 1, PenaltyKLogN ) (Akaike Information Criterion)\r\n\r\nThe parameters PenaltyK and PenaltyKLogN can only be given positive values.\r\nThe higher the values, the fewer clusters you obtain. Higher penalties discourage cluster splitting.\r\n\r\nAIC is recommended for larger probes. Evidence suggests anything between AIC and BIC gives reasonable results. \r\n\r\n+ **UseDistributional**\r\n\r\nThis enables the use of the new `distributional Expectation-Maximization' algorithm. Set this to 1. \r\n\r\nIt has been observed that using soft masks of the form. e.g.:\r\n\r\n0 0 0 0.3 0.3 0.3 1 1 1 1 1 1 0.4 0.4 0.4 0 0 0 0 0 0 \r\n\r\nleads to improved clusterings than using binary masks:\r\n\r\n0 0 0 0 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 \r\n\r\nSo your .fmask file will work better if it contains floats.\r\n\r\n+ **UseMaskedInitialConditions**, **AssignToFirstClosestMask** and **SplitEvery**\r\n\r\nThe quality of clustering obtained from EM-type algorithms is sensitive to the initialization. A good way to initialize that works better than random initializations is to start with clusters which depend on unique masks or clusters containing similar masks. Set both of these options to 1 to enable masked initializations. At the same time set **MinClusters**= **MaxClusters** to the number of distinct masks (also set MaxPossibleClusters to a value greater than this). \r\n\r\n(If you do not know the number of distinct masks, run KlustaKwik, with arbitrary values of MinClusters and MaxClusters, read the first line giving the number of distinct masks, and then prematurely terminate the program).\r\n\r\nStarting with the total number of distinct masks is not usually necessary and prohibitive in terms of memory usage for large datasets. Therefore the options \r\n**-UseMaskedInitialConditions 1 -AssignToFirstClosestMask 1** used together enable a fixed number of starting clusters (determined by MinClusters and MaxClusters) by \r\nrandomly selecting a fixed number of distinct derived binary masks and assigning points according to their their nearest mask according to Hamming distance.\r\ne.g. the derived binary mask of \r\n\r\n0 0 0 0.3 0.3 0.3 1 1 1 1 1 1 0.4 0.4 0.4 0 0 0 0 0 0\r\n\r\nis\r\n\r\n0 0 0 0 0 0 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0. \r\n\r\n**SplitEvery** is an integer which is the number of iterations after which KlustaKwik attempts to split existing clusters.\r\nWhen using masked initializations, to save time due to excessive splitting, set **SplitEvery** to a large number, close\r\nto the number of distinct masks or the number of chosen starting masks. \r\n\r\n+ **UseFeatures**\r\n\r\nMake sure to include a **1** for every feature you would like to include and a **0** for every\r\nfeature you want to leave out (i.e. features that corresponding to bad channels that you don't want).\r\n\r\n+ **PriorPoint**\r\nPlease set this to 1 at all times when using Masked KlustaKwik.\r\n\r\n2) Command line input\r\n----------------------\r\n----------------------\r\n\r\nA typical command to run the masked version of KlustaKwik therefore looks as follows in a linux terminal:\r\n\r\n    [yourterminal]$./KlustaKwik yourfetfilename shanknumber -UseDistributional 1 -FullStepEvery 1 -SplitEvery 40 -UseMaskedInitialConditions 1 -AssignToFirstClosestMask 1 -RandomSeed 123 -PriorPoint 1 -MaxIter 10000 -MaxPossibleClusters 500 -MinClusters 130 -MaxClusters 130 -PenaltyK 1 -PenaltyKLogN 0 -UseFeatures 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110\r\n    \r\ne.g. if your .fet file is called **recording.fet.4** (and your other files are **recording.mask.4**, **recording.fmask.4**)  for the fourth shank, then the command looks something like:\r\n\r\n    [yourterminal]$./KlustaKwik recording 4 -UseDistributional 1  -FullStepEvery 1 -SplitEvery 40 -UseMaskedInitialConditions 1 -AssignToFirstClosestMask 1 -RandomSeed 123 -PriorPoint 1 -MaxIter 10000 -MaxPossibleClusters 500 -MinClusters 130 -MaxClusters 130 -PenaltyK 1 -PenaltyKLogN 0 -UseFeatures 111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110\r\n\r\nYou may consider writing a script to generate such a complicated command.\r\n\r\n**We apologize for the current somewhat complicated set-up. Everything will be simplified once beta testing has been completed - slightly simplified on 23/04/13.**\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}